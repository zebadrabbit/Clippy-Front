{% extends "base.html" %}

{% block content %}
<div class="container py-4">
  <div class="row">
    <h2 class="mb-3"><i class="bi bi-gear"></i> Admin Dashboard</h2>
    <div class="col-12 col-lg-3 mb-3 mb-lg-0">
      {% set active_page = 'tiers' %}
      {% include 'admin/_includes/sidebar.html' with context %}
    </div>
    <div class="col-12 col-lg-9">
      <h3 class="mb-3">{{ 'Edit Tier' if tier else 'Create Tier' }}</h3>
      <form method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="row">
          <div class="col-md-7">
            <div class="card mb-3">
              <div class="card-header">Details</div>
              <div class="card-body">
                <div class="mb-3">
                  <label class="form-label">Name</label>
                  <input class="form-control" name="name" value="{{ tier.name if tier else '' }}" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Description</label>
                  <textarea class="form-control" rows="2" name="description">{{ tier.description if tier else '' }}</textarea>
                </div>
                <div class="mb-3">
                  <label class="form-label">Storage Limit (MB)</label>
                  <input class="form-control" name="storage_limit_mb" type="number" min="0" step="1" placeholder="e.g. 1024 for 1 GB" value="{% if tier and tier.storage_limit_bytes is not none %}{{ (tier.storage_limit_bytes/1024/1024)|round(0, 'floor')|int }}{% endif %}">
                  <div class="form-text">Leave blank for unlimited. Value is in megabytes.</div>
                </div>
                <div class="mb-3">
                  <label class="form-label">Render Time Limit (minutes per month)</label>
                  <input class="form-control" name="render_time_limit_minutes" type="number" min="0" step="1" placeholder="e.g. 30 for 30 min" value="{% if tier and tier.render_time_limit_seconds is not none %}{{ (tier.render_time_limit_seconds/60)|round(0, 'floor')|int }}{% endif %}">
                  <div class="form-text">Leave blank for unlimited.</div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-5">
            <div class="card mb-3">
              <div class="card-header">Policy</div>
              <div class="card-body">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" name="apply_watermark" id="apply_watermark" {% if tier and tier.apply_watermark %}checked{% endif %}>
                  <label class="form-check-label" for="apply_watermark">Apply watermark</label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" name="is_unlimited" id="is_unlimited" {% if tier and tier.is_unlimited %}checked{% endif %}>
                  <label class="form-check-label" for="is_unlimited">Unlimited (no quotas, no watermark)</label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" name="is_active" id="is_active" {% if (tier and tier.is_active) or not tier %}checked{% endif %}>
                  <label class="form-check-label" for="is_active">Active</label>
                </div>
                <hr>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" name="can_schedule_tasks" id="can_schedule_tasks" {% if tier and tier.can_schedule_tasks %}checked{% endif %}>
                  <label class="form-check-label" for="can_schedule_tasks">Allow Automation Scheduling</label>
                </div>
                <div class="mb-2">
                  <label class="form-label">Max Active Schedules per User</label>
                  <input class="form-control" name="max_schedules_per_user" type="number" min="0" placeholder="e.g. 1" value="{% if tier and tier.max_schedules_per_user is not none %}{{ tier.max_schedules_per_user }}{% endif %}">
                  <div class="form-text">0 or blank means not allowed unless Unlimited tier explicitly allows. Use a small number like 1â€“3.</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="d-flex justify-content-end gap-2">
          <a class="btn btn-secondary" href="{{ url_for('admin.tiers_list') }}">Cancel</a>
          <button class="btn btn-primary" type="submit">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
