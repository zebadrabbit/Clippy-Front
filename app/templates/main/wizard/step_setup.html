{# Step 1: Setup - Project configuration and search parameters #}
<div class="wizard-step" data-step="1">
  <form id="setup-form" class="row g-3">
    <div class="col-md-4">
      <label class="form-label d-flex align-items-center">
        Route
        <i class="bi bi-question-circle text-muted ms-1 help-icon"
           data-bs-toggle="tooltip"
           data-bs-placement="top"
           data-bs-html="true"
           title="<strong>Twitch:</strong> Fetch clips from your Twitch channel<br><strong>Discord:</strong> Download videos from Discord messages"></i>
      </label>
      <select class="form-select" name="route" id="route-select">
        <option value="twitch" selected>Twitch</option>
        <option value="discord">Discord</option>
      </select>
    </div>

    {# Hidden Discord channel ID from profile #}
    <input type="hidden" id="discord-channel-id" name="discord_channel_id" value="{{ discord_channel_id or '' }}">

    <div class="row g-2">
      <div class="col-12">
        <div class="alert alert-warning d-none" id="twitch-warning">
          <strong>Twitch not connected.</strong> Add your Twitch username to unlock fetching clips.
          <a href="{{ url_for('main.profile') }}" class="alert-link">Open your profile</a>.
        </div>
      </div>
      <div class="col-12">
        <div class="row g-3 align-items-stretch">
          <div class="col-md-6">
            <label class="form-label">Project Name</label>
            <input class="form-control" name="name" placeholder="My Compilation">
            <label class="form-label mt-3">Tags <span class="text-muted">(comma-separated, optional)</span></label>
            <input class="form-control" name="tags" placeholder="gaming, highlights, funny">
            <label class="form-label mt-3">Description (optional)</label>
            <textarea class="form-control" name="description" rows="3" placeholder="Short description..."></textarea>
          </div>
          <div class="col-md-5 offset-md-1">
            <div class="card audio-norm-card">
              <div class="card-header card-header--accent d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center gap-2 audio-norm-head">
                  <input class="form-check-input" type="checkbox" id="audio-norm-enabled">
                  <label class="form-label mb-0" for="audio-norm-enabled">Audio Normalization</label>
                  <i class="bi bi-question-circle text-light ms-1 help-icon"
                     data-bs-toggle="tooltip"
                     data-bs-placement="top"
                     data-bs-html="true"
                     title="Ensures consistent volume across all clips. Recommended for compilations with clips from different sources."></i>
                </div>
                <span class="small" style="opacity: .85;">optional</span>
              </div>
              <div class="card-body">
                <div class="opt-slider" id="audio-norm-slider" data-count="4">
                  <input type="radio" name="audio_norm_profile" id="an-music" value="music" data-db="-1">
                  <label for="an-music" data-label="Music (-1 dB)"></label>
                  <input type="radio" name="audio_norm_profile" id="an-podcast" value="podcast" data-db="-3">
                  <label for="an-podcast" data-label="Podcasts (-3 dB)"></label>
                  <input type="radio" name="audio_norm_profile" id="an-broadcast" value="broadcast" data-db="-2">
                  <label for="an-broadcast" data-label="Broadcast (-2 dB)"></label>
                  <input type="radio" name="audio_norm_profile" id="an-gaming" value="gaming" data-db="-4" checked>
                  <label for="an-gaming" data-label="Gaming (-4 dB)"></label>
                  <div class="pos" aria-hidden="true"></div>
                </div>
                <input type="hidden" name="audio_norm_db" id="audio_norm_db" value="-4">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-2 mb-3">
      <div class="col-md-6">
        <label class="form-label">Platform Preset</label>
        <select class="form-select" id="platformPreset" name="platform_preset">
          <option value="youtube" selected>YouTube (1080p 16:9)</option>
          <option value="youtube_shorts">YouTube Shorts (1080p 9:16 vertical)</option>
          <option value="tiktok">TikTok (1080p 9:16 vertical)</option>
          <option value="instagram_feed">Instagram Feed (1080p 1:1 square)</option>
          <option value="instagram_reel">Instagram Reels (1080p 9:16 vertical)</option>
          <option value="instagram_story">Instagram Stories (1080p 9:16 vertical)</option>
          <option value="twitter">Twitter/X (1080p 16:9)</option>
          <option value="facebook">Facebook (1080p 16:9)</option>
          <option value="twitch">Twitch Clips (1080p 16:9)</option>
        </select>
        <small class="text-muted">Automatically configure export settings for specific platforms</small>
      </div>
    </div>

    {# Vertical Video Controls (9:16 presets only) #}
    <div class="row g-2 mb-3 d-none" id="verticalVideoControls">
      <div class="col-md-12">
        <div class="alert alert-info mb-3">
          <i class="bi bi-info-circle"></i> <strong>Vertical Video Mode:</strong> Converting 16:9 clips to 9:16 format
        </div>
      </div>
      <div class="col-md-6">
        <label class="form-label">Zoom Level</label>
        <div class="d-flex align-items-center gap-2">
          <input type="range" class="form-range" id="verticalZoom" name="vertical_zoom" min="100" max="180" value="100" step="1">
          <span id="verticalZoomDisplay" class="text-muted small" style="min-width: 3.5rem;">100%</span>
        </div>
        <small class="text-muted">Zoom into 16:9 clips to fill vertical frame (100% = fit width, 120% = max zoom)</small>
      </div>
      <div class="col-md-6">
        <label class="form-label">Horizontal Alignment</label>
        <select class="form-select" id="verticalAlign" name="vertical_align">
          <option value="center" selected>Center</option>
          <option value="left">Left</option>
          <option value="right">Right</option>
        </select>
        <small class="text-muted">Horizontal position when zoomed in</small>
      </div>
    </div>

    {# Hidden output controls (controlled by platform preset) #}
    <div class="row g-2 d-none">
      <div class="col-4">
        <label class="form-label">Output</label>
        <div class="row g-2">
          <div class="col-md-4">
            <select class="form-select" name="orientation" id="orientation">
              <option value="landscape" selected>Landscape</option>
              <option value="portrait">Portrait</option>
              <option value="square">Square</option>
            </select>
          </div>
          <div class="col-md-3">
            <select class="form-select" name="resolution" id="resolution">
              <option value="720p">720p</option>
              <option value="1080p" selected>1080p</option>
              <option value="1440p">1440p</option>
            </select>
          </div>
          <div class="col-md-2">
            <select class="form-select" name="format" id="format">
              <option value="mp4" selected>MP4</option>
              <option value="webm">WebM</option>
            </select>
          </div>
          <div class="col-md-3">
            <select class="form-select" name="fps" id="fps">
              <option value="30">30 fps</option>
              <option value="60" selected>60 fps</option>
              <option value="120">120 fps</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-2">
      <div class="col-8">
        <label class="form-label">Search Parameters</label>
        <div class="row g-2">
          <div class="col-md-3">
            <label class="form-label">Compilation Length</label>
            <select class="form-select" name="compilation_length" id="compilation-length">
              <option value="auto" selected>Auto (all clips)</option>
              <option value="60">1 minute</option>
              <option value="120">2 minutes</option>
              <option value="180">3 minutes</option>
              <option value="300">5 minutes</option>
              <option value="600">10 minutes</option>
              <option value="900">15 minutes</option>
              <option value="1200">20 minutes</option>
            </select>
            <small class="text-muted">Fetches enough clips to reach target length</small>
          </div>
          <div class="col-md-2">
            <label class="form-label">Max Clips</label>
            <input type="number" min="1" max="500" step="1" class="form-control" name="max_clips" value="5">
          </div>
          {# Discord-specific parameters (hidden by default) #}
          <div class="col-md-3 d-none" id="discord-min-reactions">
            <label class="form-label"><i class="bi bi-discord"></i> Minimum Reactions</label>
            <input type="number" class="form-control" id="min-reactions" name="min_reactions" value="0" min="0" max="100">
            <small class="text-muted">Messages with at least this many reactions</small>
          </div>
          <div class="col-md-4 d-none" id="discord-emoji">
            <label class="form-label"><i class="bi bi-discord"></i> Reaction Emoji (optional)</label>
            <select class="form-select" id="reaction-emoji" name="reaction_emoji">
              <option value="">Any reaction</option>
              <option value="üëç">üëç Thumbs Up</option>
              <option value="‚ù§Ô∏è">‚ù§Ô∏è Heart</option>
              <option value="üòÇ">üòÇ Laughing</option>
              <option value="üòÆ">üòÆ Surprised</option>
              <option value="üò¢">üò¢ Sad</option>
              <option value="üò°">üò° Angry</option>
              <option value="üéâ">üéâ Party</option>
              <option value="üî•">üî• Fire</option>
              <option value="‚≠ê">‚≠ê Star</option>
              <option value="‚úÖ">‚úÖ Check</option>
            </select>
            <small class="text-muted">Filter by specific emoji</small>
          </div>
        </div>
        {# Discord setup alert (shown when Discord is selected and channel ID is missing) #}
        <div class="alert alert-info mt-3 mb-0 d-none" id="discord-setup-alert">
          <i class="bi bi-info-circle"></i> <strong>Discord Setup Required:</strong>
          {% if not discord_channel_id %}
            Set your Discord channel ID in your <a href="{{ url_for('main.profile') }}" class="alert-link">profile settings</a> to fetch clips.
          {% else %}
            Channel ID configured in your <a href="{{ url_for('main.profile') }}" class="alert-link">profile</a>.
          {% endif %}
        </div>
      </div>
      <div class="col-4">
        <label class="form-label">Date Range (Optional)</label>
        <div class="row g-2">
          <div class="col-md-6">
            <label class="form-label">Start Date</label>
            <input type="date" class="form-control" name="start_date">
          </div>
          <div class="col-md-6">
            <label class="form-label">End Date</label>
            <input type="date" class="form-control" name="end_date">
          </div>
        </div>
      </div>
    </div>
  </form>
  <div class="d-flex justify-content-end wizard-nav mt-4">
    <button class="btn btn-primary btn-glow btn-shadow-dark" id="next-1" type="button">Next: Get Clips</button>
  </div>
</div>
